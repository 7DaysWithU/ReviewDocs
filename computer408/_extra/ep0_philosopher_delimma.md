# å“²å­¦å®¶è¿›é¤é—®é¢˜

åœ¨**å“²å­¦å®¶å°±é¤é—®é¢˜**ä¸­ï¼Œ

- **â€œäº’æ–¥â€æ¡ä»¶**æ— æ³•æ¶ˆé™¤ï¼ˆç­·å­å¿…é¡»äº’æ–¥ä½¿ç”¨ï¼‰â†’ ä¸èƒ½æ”¹é€ æˆå…±äº«ï¼ˆä¸åƒ SPOOLing æŠŠæ‰“å°æœºè™šæ‹ŸåŒ–ï¼‰ï¼›
- **â€œéæŠ¢å ï¼ˆä¸å‰¥å¤ºï¼‰â€** æ˜¯ç³»ç»Ÿè®¾å®šï¼ˆä¸èƒ½å¼ºè¡Œæ‹¿èµ°å“²å­¦å®¶æ‰‹ä¸­çš„ç­·å­ï¼‰â†’ é€šå¸¸ä¸å…è®¸æ‰“ç ´ï¼›
  
å› æ­¤ï¼Œ**å®é™…å¯è¡Œçš„è§£å†³æ–¹æ¡ˆä¸»è¦é›†ä¸­åœ¨æ‰“ç ´ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶**ï¼š

1. **è¯·æ±‚å’Œä¿æŒï¼ˆHold and Waitï¼‰** â†’ ç”¨ **â€œå…¨æœ‰æˆ–å…¨æ— â€ç­–ç•¥**
2. **å¾ªç¯ç­‰å¾…ï¼ˆCircular Waitï¼‰** â†’ ç”¨ **èµ„æºåˆ†çº§ï¼ˆç¼–å·å°çš„ä¼˜å…ˆï¼‰æˆ–ä¸€äººåå‘**

ä¸‹é¢æˆ‘ä»¬ç”¨ **PV æ“ä½œï¼ˆä¿¡å·é‡ï¼‰** ç»™å‡ºè¿™ä¸¤ä¸ªæ¡ä»¶å¯¹åº”çš„ç»å…¸è§£å†³æ–¹æ¡ˆçš„**å®Œæ•´ä¼ªä»£ç å®ç°**ã€‚

---

## âœ… æ–¹æ¡ˆä¸€ï¼šæ‰“ç ´â€œè¯·æ±‚å’Œä¿æŒâ€â€”â€”å…¨æœ‰æˆ–å…¨æ— ï¼ˆå¼•å…¥ `room` ä¿¡å·é‡ï¼‰

> æ€æƒ³ï¼šé™åˆ¶æœ€å¤š **4 ä¸ªå“²å­¦å®¶åŒæ—¶å°è¯•æ‹¿ç­·å­**ï¼Œç¡®ä¿è‡³å°‘ä¸€äººèƒ½æ‹¿åˆ°ä¸¤æ ¹ï¼Œé¿å…å…¨éƒ¨æŒæœ‰å·¦ç­·ç­‰å¾…å³ç­·ã€‚

```c
#define N 5
semaphore chopstick[N] = {1, 1, 1, 1, 1};  // æ¯æ ¹ç­·å­æ˜¯ä¸€ä¸ªä¿¡å·é‡
semaphore room = 4;  // æœ€å¤šå…è®¸4äººåŒæ—¶å°è¯•è¿›é¤

void philosopher(int i) {
    while (true) {
        think();

        P(room);           // è¿›å…¥é¤å…ï¼ˆç”³è¯·â€œå°è¯•åƒé¥­â€èµ„æ ¼ï¼‰
        P(chopstick[i]);       // æ‹¿å·¦ç­·å­
        P(chopstick[(i+1)%N]); // æ‹¿å³ç­·å­
        eat();
        V(chopstick[i]);     // æ”¾å·¦ç­·å­
        V(chopstick[(i+1)%N]); // æ”¾å³ç­·å­
        V(room);          // ç¦»å¼€é¤å…

        think();
    }
}
```

âœ… æ‰“ç ´äº†ï¼š**è¯·æ±‚å’Œä¿æŒ**ï¼ˆå› ä¸ºæœ€å¤š4äººç«äº‰ï¼Œä¸å¯èƒ½å…¨éƒ¨â€œæŒå·¦ç­‰å³â€ï¼‰  
âš ï¸ æ³¨æ„ï¼šè¿™ä¸æ˜¯ AND ä¿¡å·é‡ï¼Œè€Œæ˜¯é€šè¿‡é™åˆ¶å¹¶å‘å°è¯•è€…æ•°é‡æ¥é—´æ¥å®ç°â€œå…¨æœ‰æˆ–å…¨æ— â€

---

## âœ… æ–¹æ¡ˆäºŒï¼šæ‰“ç ´â€œå¾ªç¯ç­‰å¾…â€â€”â€”èµ„æºåˆ†çº§ï¼ˆå°å·ä¼˜å…ˆï¼‰

> æ€æƒ³ï¼šè§„å®šæ‰€æœ‰å“²å­¦å®¶å¿…é¡»å…ˆæ‹¿ç¼–å·**å°çš„**ç­·å­ï¼Œå†æ‹¿ç¼–å·**å¤§çš„**ï¼Œä»è€Œç ´åç¯è·¯ç­‰å¾…ã€‚

```c
#define N 5
semaphore chopstick[N] = {1, 1, 1, 1, 1};

void philosopher(int i) {
    int left = i;
    int right = (i+1) % N;
    int first = (left < right) ? left : right;  // å°ç¼–å·ä¼˜å…ˆ
    int second = (left > right) ? left : right; // å¤§ç¼–å·åæ‹¿

    while (true) {
        think();

        P(chopstick[first]);   // å…ˆæ‹¿å°å·ç­·å­
        P(chopstick[second]);  // å†æ‹¿å¤§å·ç­·å­
        eat();
        V(chopstick[second]);
        V(chopstick[first]);

        think();
    }
}
```

âœ… æ‰“ç ´äº†ï¼š**å¾ªç¯ç­‰å¾…**ï¼ˆæ‰€æœ‰äººæŒ‰ç¼–å·é¡ºåºæ‹¿èµ„æºï¼Œæ— æ³•å½¢æˆç¯è·¯ï¼‰  
ğŸ“Œ ä¾‹å¦‚ï¼š0å·å…ˆ0å1ï¼›1å·å…ˆ1å2ï¼›... 4å·å…ˆ0å4 â†’ æ²¡æœ‰å¾ªç¯ä¾èµ–

---

## âœ… æ–¹æ¡ˆäºŒå˜ä½“ï¼šä¸€äººåå‘æ‹¿ç­·ï¼ˆä¹Ÿç ´åå¾ªç¯ç­‰å¾…ï¼‰

> è®©æœ€åä¸€ä¸ªå“²å­¦å®¶ï¼ˆå¦‚ 4 å·ï¼‰å…ˆæ‹¿å³ç­·ï¼ˆ0å·ï¼‰ï¼Œå†æ‹¿å·¦ç­·ï¼ˆ4å·ï¼‰ï¼Œå…¶ä½™æ­£å¸¸ã€‚

```c
#define N 5
semaphore chopstick[N] = {1, 1, 1, 1, 1};

void philosopher(int i) {
    while (true) {
        think();

        if (i != 4) {
            // æ™®é€šå“²å­¦å®¶ï¼šå…ˆå·¦åå³
            P(chopstick[i]);
            P(chopstick[(i+1)%N]);
        } else {
            // 4å·å“²å­¦å®¶ï¼šå…ˆå³åå·¦ï¼ˆåå‘ï¼‰
            P(chopstick[0]);        // å…ˆæ‹¿å³ç­·ï¼ˆ0å·ï¼‰
            P(chopstick[4]);        // å†æ‹¿å·¦ç­·ï¼ˆ4å·ï¼‰
        }
        eat();
        V(chopstick[i]);
        V(chopstick[(i+1)%N]);

        think();
    }
}
```

âœ… åŒæ ·æ‰“ç ´äº†ï¼š**å¾ªç¯ç­‰å¾…**ï¼ˆå¯¹ç§°æ€§è¢«ç ´åï¼Œç¯è·¯æ–­è£‚ï¼‰ã€‚æœ¬è´¨ä¸Šå’Œæ–¹æ¡ˆäºŒç›¸åŒï¼Œéƒ½æ˜¯å…ˆæ‹¿å°å·å†æ‹¿å¤§å·

---

## âœ… æ€»ç»“å¯¹æ¯”ï¼ˆPV æ“ä½œç‰ˆï¼‰

| æ–¹æ¡ˆ | æ‰“ç ´çš„æ¡ä»¶ | æ ¸å¿ƒæœºåˆ¶ | ä¿¡å·é‡æ“ä½œç‰¹ç‚¹ |
|------|-----------|----------|----------------|
| **é™åˆ¶äººæ•°ï¼ˆroom=4ï¼‰** | è¯·æ±‚å’Œä¿æŒ | æœ€å¤š4äººç«äº‰ | `P(room)` å…¥åœºï¼Œ`V(room)` ç¦»åœº |
| **èµ„æºåˆ†çº§ï¼ˆå°å·ä¼˜å…ˆï¼‰** | å¾ªç¯ç­‰å¾… | ç»Ÿä¸€æ‹¿ç­·é¡ºåº | æŒ‰ `min(i, i+1)` é¡ºåº `P` |
| **ä¸€äººåå‘** | å¾ªç¯ç­‰å¾… | ç ´åå¯¹ç§°æ€§ | ä»…ä¸€äºº `P` é¡ºåºç›¸å |

å¦‚æœç ´åè¯·æ±‚å’Œä¿æŒï¼Œé‚£ä¹ˆå°±éœ€è¦åƒæ–¹æ¡ˆä¸€ä¸€æ ·åœ¨æœ€å¤–å±‚ $\text{PV}$ ä¸è¶…è¿‡ $n-1$ çš„ä¿¡å·é‡ï¼Œ$n$ ä¸ºå“²å­¦å®¶æ•°é‡ï¼Œé€šè¿‡é™åˆ¶æœ€å¤§äººæ•°ä½¿å¾—å§‹ç»ˆè‡³å°‘æœ‰ $1$ ä¸ªäººèƒ½å®Œæ•´æ‰§è¡Œï¼›å¦‚æœç ´åå¾ªç¯ç­‰å¾…ï¼Œå°±ä¸éœ€è¦ç°åœ¨æœ€å¤§äººæ•°ï¼Œä½†éœ€è¦å…ˆå–å°å·å†å–å¤§å·ï¼Œä½†å› ä¸ºå¾ªç¯çš„æ€§è´¨ï¼Œé¦–å°¾ä¸¤ä¸ªäººå¿…å®šäº‰æŠ¢åŒä¸€ä¸ªèµ„æºï¼Œè¿™ä¹Ÿé—´æ¥æ»¡è¶³äº†æœ€å¤š $n-1$ ä¸ªäººè¢«åŒæ—¶æœåŠ¡ï¼ˆæ— è®ºæ˜¯è·å¾—æœåŠ¡è¿˜æ˜¯ç­‰å¾…æœåŠ¡ï¼‰ã€‚âš ï¸ ***æ€»ç»“æ¥è¯´å°±æ˜¯ä¸€å®šè‡³å°‘å¾—æœ‰ $1$ ä¸ªäººèƒ½å®Œæ•´æ‰§è¡Œ***

åœ¨è€ƒè¯•ä¸­å¦‚æœè¦æ±‚â€œç”¨ PV æ“ä½œè§£å†³å“²å­¦å®¶å°±é¤é—®é¢˜â€ï¼Œæ¨èï¼š

1. **é¦–é€‰â€œèµ„æºåˆ†çº§â€æ–¹æ¡ˆ**ï¼šé€»è¾‘æ¸…æ™°ã€ä»£ç ç®€æ´ã€æ— é¢å¤–ä¿¡å·é‡ã€‚
2. **æ¬¡é€‰â€œroom=4â€æ–¹æ¡ˆ**ï¼šç›´è§‚ä½“ç°â€œæ‰“ç ´è¯·æ±‚å’Œä¿æŒâ€ã€‚
3. **é¿å…ä½¿ç”¨ AND ä¿¡å·é‡**ï¼ˆé™¤éé¢˜ç›®å…è®¸ï¼‰ï¼Œå› ä¸æ˜¯æ‰€æœ‰ç³»ç»Ÿæ”¯æŒã€‚

ğŸ“Œ **ä¸€å¥è¯æ€»ç»“**ï¼š
> åœ¨äº’æ–¥å’ŒéæŠ¢å ä¸å¯å˜çš„å‰æä¸‹ï¼Œç”¨ PV æ“ä½œè§£å†³å“²å­¦å®¶é—®é¢˜ï¼Œå…³é”®æ˜¯ï¼š
>
> - æ‰“ç ´**è¯·æ±‚å’Œä¿æŒ** â†’ ç”¨ `room` é™åˆ¶å¹¶å‘å°è¯•è€…ï¼›
> - æ‰“ç ´**å¾ªç¯ç­‰å¾…** â†’ ç”¨**ç¼–å·é¡ºåº**æˆ–**ä¸€äººåå‘**ç»Ÿä¸€æ‹¿ç­·é¡ºåºã€‚
